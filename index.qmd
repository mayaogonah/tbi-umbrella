---
title: "Health Outcomes Following TBI"
description: "An umbrella review of a wide range of health outcomes following traumatic brain injury (TBI). This document is an accompanying file of the paper: Ogonah et al. An umbrella review of health outcomes following traumatic brain injury. Nature Mental Health. Jan 2025."
doi: 10.1038/s44220-024-00356-5


author:
    name: "Maya Ogonah"
    affiliation: "University of Oxford"
    email: maya.ogonah@psych.ox.ac.uk
    
code-fold: true 
code-summary: "Show the code"
    
date: today
toc: true
toc_float: true
toc-location: left
number-sections: true

title-block-banner: "#f0f3f5"
title-block-banner-color: "black"
---

## Libraries and data

Load packages

```{r, message=FALSE, results='hide'}
if (!require("pacman")) install.packages("pacman")

library(pacman)
pacman::p_load(
  meta,
  extrafont,
  effectsize,
  metafor,
  DescTools,
  openxlsx,
  tidyverse,
  metafor,
  cowplot,
  robvis,
  ggplot2
  )
```

Load data

```{r}
data <- read.xlsx("forest_plot.xlsx")
data_rob1 <- read.xlsx("amstar2_rob.xlsx")
```


## Forest plot

```{r, fig.width=12, fig.height=8}
shapes = c(15, 17, 18)
shapes <- shapes[as.numeric(data$Group)]

  forest(x = data$Summary.Statistic, ci.lb = data$Lower.CI, ci.ub = data$Upper.CI, 
         slab = data$Health.Outcome,
         psize = rep(1, length(data$Summary.Statistic)),
         xlab = "Risk Ratio (RR)", refline = 1.0,
         ylim = c(-0.5, 31), xlim = c(-6, 10),
         ilab = c(data$Sample.size), ilab.xpos = -1,
         at = c(0.5, 1.0, 2, 4, 8),
         rows = c(1:2, 5, 8, 11:16, 19:27),
         cex = 1.0, pch = shapes, header = "Health Outcome")
  
  
  op <- par(cex=1.0, font=2)
  text(-6, c(3, 6, 9, 17, 28), pos = 4,
       c("Severe TBI", "Moderate to Severe TBI", "Moderate TBI", "Mild TBI", "TBI of any severity"))
  
  op <- par(cex=1.0, font=2)
  text(7.9, 30.1, "RR")
  
  op <- par(cex=1.0, font=2)
  text(-1, 30.1, "Sample Size")
  
```

## Converting effect sizes

### Hedge's g to RR

Hedge's g was considered approximately equivalent to Cohen's d. The following code was used to convert cohen's d to OR, which was inturn converted into a RR using the code below.

```{r}
OR <- d_to_oddsratio(4.22, log = FALSE)

var_d <- 0.79

variance_OR <- exp(var_d * (pi^2 / 3))

var_ll <- OR - variance_OR
var_ul <- OR + variance_OR
```

### OR to RR

I converted ORs to RR using the *ORTORelRisk* package in DescTools.

```{r, results='hide'}
## Include ..c(OR, UL, CL, p0)
## p0 is the baseline risk 

ORToRelRisk(c(6.70, 2.02, 16.82), 0.011319)
```

### PR to RR

Prevalence ratios were converted to RR using the following code.

```{r}
prevalence_ratio <- 4.51  # Replace with your prevalence ratio
prevalence_reference <- 0.217  # Replace with the prevalence in the reference group

risk_ratio <- prevalence_ratio / (1 - prevalence_reference + (prevalence_reference * prevalence_ratio))

  ## calculate lower limit ###
  ll_prevalence_ratio <- 2.12  # Replace with your prevalence ratio
  ll_prevalence_reference <- 0.217  # Replace with the prevalence in the reference group
  
  ll_risk_ratio <- prevalence_ratio / (1 - ll_prevalence_reference + (ll_prevalence_reference * ll_prevalence_ratio))
  
  ## calculate upper limit ###
  ul_prevalence_ratio <- 9.58  # Replace with your prevalence ratio
  ul_prevalence_reference <- 0.217  # Replace with the prevalence in the reference group
  
  ul_risk_ratio <- prevalence_ratio / (1 - ul_prevalence_reference + (ul_prevalence_reference * ul_prevalence_ratio))

```
